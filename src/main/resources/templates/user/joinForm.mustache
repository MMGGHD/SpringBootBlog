<!-- Form태그가 있는 문서는 ---form의 문법 -->
{{> /layout/header}}

<!-- Form태그의 method는 Default값이 get요청, Insert할때는 post요청-->
<!-- 요청을 하면 localhost:8080/join 에 post요청됨-->
<!-- username=사용자입력값&password=사용자입력값&email=사용자입력값 << x-www 형식으로 전달된다. 
    (입력값은 value에 들어간다.)-->

<div class="container p-5">
    <div class="card">
        <div class="card-header"><b>회원가입을 해주세요</b></div>
        <div class="card-body">
            <form action="/join" method="post" enctype="application/x-www-form-urlencoded">
                <div class="mb-3 mt-1">
                    <input type="text" class="form-control" placeholder="Enter username" name="username" required
                        maxlength="20">
                    {{! '중복체크' 버튼을 클릭하면 자바스크립트 실행되어야함 << JS 통신 필요 }} <button type="button" onclick="check()">
                        중복체크</button>
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" placeholder="Enter password" name="password" required
                        maxlength="20">
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" placeholder="Enter email" name="email" required
                        maxlength="20">
                </div>

                <!-- type="submit" << Form태그 input 내의 정보를 '한번에' 전송한다.-->
                <!-- 반드시 form태그 안에 있어야 적용된다.-->
                <button type="submit" class="btn btn-primary form-control">회원가입</button>
        </div>
    </div>
    </form>

    <script>
        function check() {
            // fetch << JS가 제공하는 기본함수(promise로 구성됨)
            // fetch() << Spring에 ()안에있는 URL을 보냄
            // 응답코드가 200대면 then()실행
            // 응답코드가 나머지면 catch()실행
            fetch("/check?username=ssar")
                // Spring에서 준 응답이 resp로 들어오게 된다.
                // 에러가 발생했을때는 err로 들어가게 된다.
                .then((resp) => {
                    // 상태코드가 200(정상)이냐 아니냐로 로직 구분
                    if (resp.status == 200) {
                        alert("유저네임이 중복되지 않았습니다. 사용하셔도 됩니다.")
                    } else {
                        alert("유저네임이 중복되었습니다.")
                    }
                }).catch((err) => {
                    console.log(err)
                })
        }
    </script>
    {{> /layout/footer}}